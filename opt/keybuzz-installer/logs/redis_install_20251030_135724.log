
Installation Redis HA - Architecture complÃ¨te (IP privÃ©e + Watcher)
Timestamp: 2025-10-30 13:57:24

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 0: VÃ©rifications prÃ©alables                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Serveurs Redis trouvÃ©s: 3
  Serveurs HAProxy trouvÃ©s: 2

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 1: Gestion sÃ©curisÃ©e des credentials                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Chargement des credentials existants...
  Hash du mot de passe: e692a9301269609a...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 2: PrÃ©paration des serveurs Redis                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  PrÃ©paration de redis-01 (10.0.0.123)...
    âœ“ Structure crÃ©Ã©e
  PrÃ©paration de redis-02 (10.0.0.124)...
    âœ“ Structure crÃ©Ã©e
  PrÃ©paration de redis-03 (10.0.0.125)...
    âœ“ Structure crÃ©Ã©e

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 3: DÃ©ploiement Redis + Sentinel                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  DÃ©ploiement de redis-01 comme master initial...
c5d8abc18ab2fa2e5aa53f5d72e15560d0444714c6b59f9899b85b2dfba405c4
44df5ce5bfec8132db77024b178e8a6684f58e077053cec6d121db9f2ce0b81f
    âœ“ Redis Master + Sentinel dÃ©marrÃ©s
  DÃ©ploiement de redis-02 comme replica...
5f672f6275307fed670ea2d3231474d19d7d46ff32844e1f0a3cf4c66aac6fba
051019e034b7fe6a756e5e46905068d490a9e3ce47cae276cee40684db602662
    âœ“ Redis Replica + Sentinel dÃ©marrÃ©s
  DÃ©ploiement de redis-03 comme replica...
e725b15667a827089e1d395dd63b49d580906bed1cae0341388d4128a83bc50f
84d2b2e49638867bc0cfe272ec437afaebb30c5c2fd9edc0e6d4f85a7018642b
    âœ“ Redis Replica + Sentinel dÃ©marrÃ©s

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 4: VÃ©rification du cluster Redis                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Master actuel dÃ©tectÃ©: 10.0.0.123

  Test de connexion Redis:
    redis-01: [0;32mOK[0m (role: master)
    redis-02: [0;32mOK[0m (role: slave)
    redis-03: [0;32mOK[0m (role: slave)

  Test des Sentinels:
    redis-01: [0;31mKO[0m
    redis-02: [0;31mKO[0m
    redis-03: [0;31mKO[0m

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 5: Load Balancer avec Watcher Sentinel (PATCHÃ‰)          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Configuration haproxy-01 (10.0.0.11) avec watcher...
465bf9ee4a9ee5fce15d559e57fc7116d49f85dec97d32eabf1dc84132b8af59
2637d7ba03d33f0189eeede81e45d090cc7f1798aa5426ec85b0a379708c909d
    âœ“ HAProxy + Watcher configurÃ©s sur IP 10.0.0.11:6379
  Configuration haproxy-02 (10.0.0.12) avec watcher...
d1cb4280ea160f3c7c8398c2cdeee8b8cebac26cfcd79914473be4724913c72d
7f84fc402785048d086372662f200addd620ffeec884ddd9e1978fbeb49e0235
    âœ“ HAProxy + Watcher configurÃ©s sur IP 10.0.0.12:6379

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 6: Tests finaux + Failover                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Test HAProxy locaux:
    haproxy-01: [0;32mOK[0m
    haproxy-02: [0;32mOK[0m

  Test via Load Balancer Hetzner (10.0.0.10:6379):
    PING: [0;31mKO[0m
    SET/GET: [0;31mKO[0m

  Test de failover automatique (simulation):
    1. DÃ©tection du master actuel...
       Master: 
    2. Pour tester le failover manuellement:
       ssh root@ 'docker stop redis'
       Attendre 10-15s puis vÃ©rifier que le watcher a mis Ã  jour HAProxy
       VÃ©rifier: redis-cli -h 10.0.0.10 -p 6379 -a "$REDIS_PASSWORD" PING

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[0;31mKO[0m Installation incomplÃ¨te
VÃ©rifier les logs: /opt/keybuzz-installer/logs/redis_install_20251030_135724.log
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Master actuel dÃ©tectÃ©: 10.0.0.123

  Test de connexion Redis:
    redis-01: [0;32mOK[0m (role: master)
    redis-02: [0;32mOK[0m (role: slave)
    redis-03: [0;32mOK[0m (role: slave)

  Test des Sentinels:
    redis-01: [0;31mKO[0m
    redis-02: [0;31mKO[0m
    redis-03: [0;31mKO[0m

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 5: Load Balancer avec Watcher Sentinel (PATCHÃ‰)          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Configuration haproxy-01 (10.0.0.11) avec watcher...
465bf9ee4a9ee5fce15d559e57fc7116d49f85dec97d32eabf1dc84132b8af59
2637d7ba03d33f0189eeede81e45d090cc7f1798aa5426ec85b0a379708c909d
    âœ“ HAProxy + Watcher configurÃ©s sur IP 10.0.0.11:6379
  Configuration haproxy-02 (10.0.0.12) avec watcher...
d1cb4280ea160f3c7c8398c2cdeee8b8cebac26cfcd79914473be4724913c72d
7f84fc402785048d086372662f200addd620ffeec884ddd9e1978fbeb49e0235
    âœ“ HAProxy + Watcher configurÃ©s sur IP 10.0.0.12:6379

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 6: Tests finaux + Failover                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Test HAProxy locaux:
    haproxy-01: [0;32mOK[0m
    haproxy-02: [0;32mOK[0m

  Test via Load Balancer Hetzner (10.0.0.10:6379):
    PING: [0;31mKO[0m
    SET/GET: [0;31mKO[0m

  Test de failover automatique (simulation):
    1. DÃ©tection du master actuel...
       Master: 
    2. Pour tester le failover manuellement:
       ssh root@ 'docker stop redis'
       Attendre 10-15s puis vÃ©rifier que le watcher a mis Ã  jour HAProxy
       VÃ©rifier: redis-cli -h 10.0.0.10 -p 6379 -a "$REDIS_PASSWORD" PING

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[0;31mKO[0m Installation incomplÃ¨te
VÃ©rifier les logs: /opt/keybuzz-installer/logs/redis_install_20251030_135724.log
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
