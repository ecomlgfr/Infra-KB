
DÃ©ploiement Vault - Architecture KeyBuzz
Timestamp: 2025-11-08 00:59:44

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 0: VÃ©rifications prÃ©alables                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â†’ Credentials PostgreSQL ... [0;32mOK[0m
â†’ Cluster K3s ... [0;32mOK[0m

Configuration :
  PostgreSQL : 10.0.0.10:5432 (LB â†’ HAProxy â†’ Patroni)
  Port Vault : 8200
  Backend    : PostgreSQL (HA)


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 1: PrÃ©paration base PostgreSQL                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CrÃ©ation base et user Vault...
[0;32mOK[0m Connexion PostgreSQL OK
DO
GRANT
You are now connected to database "vault" as user "postgres".
ALTER SCHEMA
GRANT
GRANT
GRANT
ALTER DEFAULT PRIVILEGES
ALTER DEFAULT PRIVILEGES
[0;32mOK[0m Base vault crÃ©Ã©e

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 2: CrÃ©ation namespace                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

namespace/vault created
[0;32mOK[0m Namespace vault crÃ©Ã©

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 3: CrÃ©ation secrets                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

secret/vault-secrets created
[0;32mOK[0m Secrets Vault crÃ©Ã©s

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 4: DÃ©ploiement Vault DaemonSet                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

configmap/vault-config created
daemonset.apps/vault created
service/vault created
Error from server (BadRequest): error decoding patch: invalid character '\n' in string literal
[0;32mOK[0m Vault DaemonSet dÃ©ployÃ©

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 5: CrÃ©ation Ingress                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ingress.networking.k8s.io/vault created
[0;32mOK[0m Ingress vault crÃ©Ã©

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 6: Attente dÃ©marrage (60s)                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•â•â• VÃ©rification â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Pods Vault :
NAME          READY   STATUS             RESTARTS      AGE   IP           NODE            NOMINATED NODE   READINESS GATES
vault-24qcf   0/1     CrashLoopBackOff   3 (4s ago)    61s   10.0.0.102   k3s-master-03   <none>           <none>
vault-27vxd   0/1     CrashLoopBackOff   3 (5s ago)    61s   10.0.0.100   k3s-master-01   <none>           <none>
vault-8qv9p   0/1     CrashLoopBackOff   3 (16s ago)   61s   10.0.0.111   k3s-worker-02   <none>           <none>
vault-cdfrm   0/1     CrashLoopBackOff   3 (5s ago)    61s   10.0.0.114   k3s-worker-05   <none>           <none>
vault-krcsg   0/1     CrashLoopBackOff   2 (34s ago)   61s   10.0.0.112   k3s-worker-03   <none>           <none>
vault-l8wl9   0/1     CrashLoopBackOff   3 (16s ago)   61s   10.0.0.101   k3s-master-02   <none>           <none>
vault-thhbg   0/1     CrashLoopBackOff   3 (15s ago)   61s   10.0.0.110   k3s-worker-01   <none>           <none>
vault-zwf2l   0/1     Error              3 (34s ago)   61s   10.0.0.113   k3s-worker-04   <none>           <none>

Services :
NAME    TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)                         AGE
vault   NodePort   10.43.43.198   <none>        8200:30820/TCP,8201:30821/TCP   61s

Ingress :
NAME    CLASS   HOSTS              ADDRESS     PORTS   AGE
vault   nginx   vault.keybuzz.io   localhost   80      60s

DaemonSet :
NAME    DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE
vault   8         8         0       8            0           <none>          61s
