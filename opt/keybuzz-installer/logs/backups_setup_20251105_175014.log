
Configuration backups automatiques - Architecture KeyBuzz
Timestamp: 2025-11-05 17:50:14

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 0: VÃ©rifications prÃ©alables                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[0;32mOK[0m IPs rÃ©cupÃ©rÃ©es
  MinIO       : 10.0.0.134
  DB Master   : 10.0.0.120
  Redis-01    : 10.0.0.123
  K3s Master  : 10.0.0.100

[0;32mOK[0m Credentials MinIO chargÃ©s
[0;32mOK[0m Credentials PostgreSQL chargÃ©s

Configurer les backups automatiques ? (yes/NO) : 
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 1: Configuration bucket MinIO                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

mc: <ERROR> Unable to initialize new alias from the provided credentials. Get "http://localhost:9000/probe-bsign-mve9dxgijkbnr3s4e0xakdtghetkdj/?location=": dial tcp [::1]:9000: connect: connection refused.
Bucket created successfully `keybuzz/keybuzz-backups`.
Bucket created successfully `keybuzz/keybuzz-backups/postgresql`.
Bucket created successfully `keybuzz/keybuzz-backups/redis`.
Bucket created successfully `keybuzz/keybuzz-backups/k3s-resources`.
Bucket created successfully `keybuzz/keybuzz-backups/apps-data`.
mc: <ERROR> Unable to fetch lifecycle rules for keybuzz/keybuzz-backups: `GetLifecycle` is not supported for `filesystem`.
âœ“ Bucket et dossiers crÃ©Ã©s
[0;32mOK[0m Bucket MinIO configurÃ©

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 2: Script backup PostgreSQL                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Script PostgreSQL crÃ©Ã©
[0;32mOK[0m Script backup PostgreSQL crÃ©Ã©

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 3: Script backup Redis                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Script Redis crÃ©Ã©
[0;32mOK[0m Script backup Redis crÃ©Ã©

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 4: Script backup K3s Resources                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Script K3s crÃ©Ã©
[0;32mOK[0m Script backup K3s crÃ©Ã©

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 5: Configuration crontabs                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â†’ Configuration backup PostgreSQL...
âœ“ Crontab PostgreSQL configurÃ© (2h00)
â†’ Configuration backup Redis...
âœ“ Crontab Redis configurÃ© (3h00)
â†’ Configuration backup K3s...
âœ“ Crontab K3s configurÃ© (4h00)
[0;32mOK[0m Crontabs configurÃ©s

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 6: Test des backups                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Lancer un test des backups maintenant ? (yes/NO) : 
â†’ Test backup PostgreSQL...
Backup postgres...
/opt/keybuzz/scripts/backup_postgresql.sh: line 16: POSTGRES_PASSWORD: unbound variable
Backup n8n...
/opt/keybuzz/scripts/backup_postgresql.sh: line 16: POSTGRES_PASSWORD: unbound variable
Backup chatwoot...
/opt/keybuzz/scripts/backup_postgresql.sh: line 16: POSTGRES_PASSWORD: unbound variable
Backup litellm...
/opt/keybuzz/scripts/backup_postgresql.sh: line 16: POSTGRES_PASSWORD: unbound variable
Backup superset...
/opt/keybuzz/scripts/backup_postgresql.sh: line 16: POSTGRES_PASSWORD: unbound variable
Backup qdrant...
/opt/keybuzz/scripts/backup_postgresql.sh: line 16: POSTGRES_PASSWORD: unbound variable
Backup vault...
/opt/keybuzz/scripts/backup_postgresql.sh: line 16: POSTGRES_PASSWORD: unbound variable
/opt/keybuzz/scripts/backup_postgresql.sh: line 20: POSTGRES_PASSWORD: unbound variable
/opt/keybuzz/scripts/backup_postgresql.sh: line 23: MINIO_ACCESS_KEY: unbound variable

â†’ Test backup Redis...
/opt/keybuzz/scripts/backup_redis.sh: line 12: REDIS_PASSWORD: unbound variable

â†’ Test backup K3s...
Backup resources K8s...
/opt/keybuzz/scripts/backup_k3s.sh: line 36: MINIO_ACCESS_KEY: unbound variable

[0;32mOK[0m Tests des backups terminÃ©s

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         âœ… Backups automatiques configurÃ©s avec succÃ¨s         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ Configuration :
  Bucket MinIO   : s3://keybuzz-backups/
  RÃ©tention      : 30 jours
  URL MinIO      : http://s3.keybuzz.io:9000

ğŸ“… Planning :
  PostgreSQL     : Tous les jours Ã  2h00
  Redis          : Tous les jours Ã  3h00
  K3s Resources  : Tous les jours Ã  4h00

ğŸ“‚ Dossiers MinIO :
  PostgreSQL     : keybuzz-backups/postgresql/
  Redis          : keybuzz-backups/redis/
  K3s Resources  : keybuzz-backups/k3s-resources/

ğŸ”§ Scripts crÃ©Ã©s :
  PostgreSQL     : /opt/keybuzz/scripts/backup_postgresql.sh
  Redis          : /opt/keybuzz/scripts/backup_redis.sh
  K3s            : /opt/keybuzz/scripts/backup_k3s.sh

ğŸ“Š Logs :
  PostgreSQL     : /var/log/backup_postgresql.log
  Redis          : /var/log/backup_redis.log
  K3s            : /var/log/backup_k3s.log

ğŸ” VÃ©rifier les backups :
  mc ls keybuzz/keybuzz-backups/postgresql/
  mc ls keybuzz/keybuzz-backups/redis/
  mc ls keybuzz/keybuzz-backups/k3s-resources/

âš ï¸  IMPORTANT :
  - Testez rÃ©guliÃ¨rement la restauration des backups
  - Surveillez l'espace disque MinIO
  - Configurez des alertes sur les Ã©checs de backup

Prochaine Ã©tape :
  ./21_final_validation_complete.sh

