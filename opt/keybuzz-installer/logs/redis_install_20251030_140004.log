
Installation Redis HA - Architecture complÃ¨te (IP privÃ©e + Watcher)
Timestamp: 2025-10-30 14:00:04

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 0: VÃ©rifications prÃ©alables                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Serveurs Redis trouvÃ©s: 3
  Serveurs HAProxy trouvÃ©s: 2

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 1: Gestion sÃ©curisÃ©e des credentials                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Chargement des credentials existants...
  Hash du mot de passe: e692a9301269609a...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 2: PrÃ©paration des serveurs Redis                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  PrÃ©paration de redis-01 (10.0.0.123)...
redis
sentinel
redis
sentinel
    âœ“ Structure crÃ©Ã©e
  PrÃ©paration de redis-02 (10.0.0.124)...
redis
sentinel
redis
sentinel
    âœ“ Structure crÃ©Ã©e
  PrÃ©paration de redis-03 (10.0.0.125)...
redis
sentinel
redis
sentinel
    âœ“ Structure crÃ©Ã©e

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 3: DÃ©ploiement Redis + Sentinel                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  DÃ©ploiement de redis-01 comme master initial...
5234a64d1d32c942e3439b0bb71c80a9406be1874084d9a523a050dd2712633f
b07de8252442e765d55009d08140c446f795a01256e5e44ec1a1ecf9b1996596
    âœ“ Redis Master + Sentinel dÃ©marrÃ©s
  DÃ©ploiement de redis-02 comme replica...
2b1a70d8d4d3f82de16f1cf732160d9251b2c5f00a7f556b37f407308541bc8e
547fe2e132bb33f7af5ebc44ce6b221fb0862b902fdc23ba45b87bb6a71c378a
    âœ“ Redis Replica + Sentinel dÃ©marrÃ©s
  DÃ©ploiement de redis-03 comme replica...
1c0bd8f7c01971ac2988fd75d1ef36fd2f54642c3f51f8de2e9bab2f6f159451
b193b75c94e000a5a5bc8e33a1771060df5ac4579c21280d052b046bf968f561
    âœ“ Redis Replica + Sentinel dÃ©marrÃ©s

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 4: VÃ©rification du cluster Redis                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Master actuel dÃ©tectÃ©: 10.0.0.123

  Test de connexion Redis:
    redis-01: [0;32mOK[0m (role: master)
    redis-02: [0;32mOK[0m (role: slave)
    redis-03: [0;32mOK[0m (role: slave)

  Test des Sentinels:
    redis-01: [0;31mKO[0m
    redis-02: [0;31mKO[0m
    redis-03: [0;31mKO[0m

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 5: Load Balancer avec Watcher Sentinel (PATCHÃ‰)          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Configuration haproxy-01 (10.0.0.11) avec watcher...
haproxy-redis
redis-sentinel-watcher
haproxy-redis
redis-sentinel-watcher
9289dcbb9da70844e173a6c8cc7e2025f2ac3cbe0d3413f2499ffffbeaaa965c
2b06b587ccad72e470916fb1910c0dd0e55a2e600e8690d477a51e496a465e45
    âœ“ HAProxy + Watcher configurÃ©s sur IP 10.0.0.11:6379
  Configuration haproxy-02 (10.0.0.12) avec watcher...
haproxy-redis
redis-sentinel-watcher
haproxy-redis
redis-sentinel-watcher
5614074bc7d15a8238dfb91aa3ac4b837915a8c806e00c2acc0f4e70f9690c2c
ec418eb0b312eb43e2a81a22267a620e911e49e53148a0cb7bd3fbc23974e856
    âœ“ HAProxy + Watcher configurÃ©s sur IP 10.0.0.12:6379

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 6: Tests finaux + Failover                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Test HAProxy locaux:
    haproxy-01: [0;32mOK[0m
    haproxy-02: [0;32mOK[0m

  Test via Load Balancer Hetzner (10.0.0.10:6379):
    PING: [0;32mOK[0m
    SET/GET: [0;32mOK[0m

  Test de failover automatique (simulation):
    1. DÃ©tection du master actuel...
       Master: 
    2. Pour tester le failover manuellement:
       ssh root@ 'docker stop redis'
       Attendre 10-15s puis vÃ©rifier que le watcher a mis Ã  jour HAProxy
       VÃ©rifier: redis-cli -h 10.0.0.10 -p 6379 -a "$REDIS_PASSWORD" PING

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[0;32mOK[0m REDIS HA INSTALLATION COMPLÃˆTE ET OPÃ‰RATIONNELLE

Endpoint: 10.0.0.10:6379
Password: [voir /opt/keybuzz-installer/credentials/redis.env]
Watcher Sentinel: ACTIF (vÃ©rifie toutes les 5s)
Bind: IP privÃ©e uniquement (sÃ©curisÃ©)

RÃ©sumÃ© complet: /opt/keybuzz-installer/credentials/redis-summary.txt
Logs: tail -n 50 /opt/keybuzz-installer/logs/redis_install_20251030_140004.log
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Configuration haproxy-01 (10.0.0.11) avec watcher...
haproxy-redis
redis-sentinel-watcher
haproxy-redis
redis-sentinel-watcher
9289dcbb9da70844e173a6c8cc7e2025f2ac3cbe0d3413f2499ffffbeaaa965c
2b06b587ccad72e470916fb1910c0dd0e55a2e600e8690d477a51e496a465e45
    âœ“ HAProxy + Watcher configurÃ©s sur IP 10.0.0.11:6379
  Configuration haproxy-02 (10.0.0.12) avec watcher...
haproxy-redis
redis-sentinel-watcher
haproxy-redis
redis-sentinel-watcher
5614074bc7d15a8238dfb91aa3ac4b837915a8c806e00c2acc0f4e70f9690c2c
ec418eb0b312eb43e2a81a22267a620e911e49e53148a0cb7bd3fbc23974e856
    âœ“ HAProxy + Watcher configurÃ©s sur IP 10.0.0.12:6379

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 6: Tests finaux + Failover                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Test HAProxy locaux:
    haproxy-01: [0;32mOK[0m
    haproxy-02: [0;32mOK[0m

  Test via Load Balancer Hetzner (10.0.0.10:6379):
    PING: [0;32mOK[0m
    SET/GET: [0;32mOK[0m

  Test de failover automatique (simulation):
    1. DÃ©tection du master actuel...
       Master: 
    2. Pour tester le failover manuellement:
       ssh root@ 'docker stop redis'
       Attendre 10-15s puis vÃ©rifier que le watcher a mis Ã  jour HAProxy
       VÃ©rifier: redis-cli -h 10.0.0.10 -p 6379 -a "$REDIS_PASSWORD" PING

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[0;32mOK[0m REDIS HA INSTALLATION COMPLÃˆTE ET OPÃ‰RATIONNELLE

Endpoint: 10.0.0.10:6379
Password: [voir /opt/keybuzz-installer/credentials/redis.env]
Watcher Sentinel: ACTIF (vÃ©rifie toutes les 5s)
Bind: IP privÃ©e uniquement (sÃ©curisÃ©)

RÃ©sumÃ© complet: /opt/keybuzz-installer/credentials/redis-summary.txt
Logs: tail -n 50 /opt/keybuzz-installer/logs/redis_install_20251030_140004.log
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
