
DÃ©ploiement Chatwoot - Architecture KeyBuzz (CORRIGÃ‰)
Timestamp: 2025-11-02 10:28:27

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 0: VÃ©rifications prÃ©alables                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â†’ Credentials PostgreSQL ... [0;32mOK[0m
â†’ Credentials Redis ... [0;32mOK[0m
â†’ Credentials RabbitMQ ... [0;32mOK[0m
â†’ Cluster K3s ... [0;32mOK[0m

VÃ©rification des services backend (via LB 10.0.0.10) :
  â†’ PostgreSQL (10.0.0.10:5432) ... [0;32mOK[0m
  â†’ Redis (10.0.0.10:6379) ... [0;32mOK[0m
  â†’ RabbitMQ (10.0.0.10:5672) ... [0;32mOK[0m

Architecture validÃ©e :
  âœ“ PostgreSQL : 10.0.0.10:5432 (via LB Hetzner â†’ HAProxy â†’ Patroni)
  âœ“ Redis      : 10.0.0.10:6379 (via LB Hetzner â†’ HAProxy â†’ Sentinel)
  âœ“ RabbitMQ   : 10.0.0.10:5672 (via LB Hetzner â†’ HAProxy â†’ Cluster)

Continuer le dÃ©ploiement Chatwoot ? (yes/NO) : 
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 0.5: Nettoyage des ressources existantes                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Suppression des dÃ©ploiements existants (si prÃ©sents)...
deployment.apps "chatwoot-web" deleted from chatwoot namespace
deployment.apps "chatwoot-worker" deleted from chatwoot namespace
  (dÃ©jÃ  supprimÃ©)
Attente de la suppression complÃ¨te (10s)...
[0;32mOK[0m Nettoyage terminÃ©

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 1: CrÃ©ation namespace et secrets                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[0;32mOK[0m Namespace chatwoot crÃ©Ã©

CrÃ©ation du secret Chatwoot...
secret/chatwoot-secrets configured
[0;32mOK[0m Secret chatwoot-secrets crÃ©Ã©

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 2: DÃ©ploiement Chatwoot (Web + Workers + Migration)     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

job.batch/chatwoot-db-migrate created
deployment.apps/chatwoot-web created
deployment.apps/chatwoot-worker created
service/chatwoot unchanged
ingress.networking.k8s.io/chatwoot unchanged
[0;32mOK[0m Ressources Chatwoot crÃ©Ã©es

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Ã‰TAPE 3: Attente migration DB et dÃ©marrage pods               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Attente du job de migration (120s max)...
job.batch/chatwoot-db-migrate condition met

Attente des pods Web (90s max)...
[0;33mWARN[0m Pods pas encore prÃªts

Attente des pods Workers (60s max)...
pod/chatwoot-worker-bc7fff5db-hr7pk condition met
pod/chatwoot-worker-bc7fff5db-rpgml condition met

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ RÃ‰SUMÃ‰ FINAL                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ã‰tat des pods Chatwoot :
NAME                              READY   STATUS             RESTARTS      AGE    IP           NODE            NOMINATED NODE   READINESS GATES
chatwoot-db-migrate-r8k55         0/1     Completed          0             109s   10.42.3.45   k3s-worker-01   <none>           <none>
chatwoot-web-7999f5bff-7jmdf      0/1     CrashLoopBackOff   4 (21s ago)   109s   10.42.7.17   k3s-worker-05   <none>           <none>
chatwoot-web-7999f5bff-s82rj      0/1     CrashLoopBackOff   4 (20s ago)   109s   10.42.3.46   k3s-worker-01   <none>           <none>
chatwoot-worker-bc7fff5db-hr7pk   1/1     Running            0             109s   10.42.4.23   k3s-worker-02   <none>           <none>
chatwoot-worker-bc7fff5db-rpgml   1/1     Running            0             109s   10.42.6.26   k3s-worker-04   <none>           <none>

Ã‰tat du service :
NAME       TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)    AGE
chatwoot   ClusterIP   10.43.13.99   <none>        3000/TCP   41h

Ã‰tat de l'Ingress :
NAME       CLASS   HOSTS             ADDRESS     PORTS   AGE
chatwoot   nginx   chat.keybuzz.io   localhost   80      41h

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[0;32mOK[0m CHATWOOT DÃ‰PLOYÃ‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

URL d'accÃ¨s : http://chat.keybuzz.io

âš ï¸  IMPORTANT - Configuration DNS requise :
  chat.keybuzz.io  A  49.13.42.76      TTL 60
  chat.keybuzz.io  A  138.199.132.240  TTL 60

Premier accÃ¨s :
  1. Ouvrir http://chat.keybuzz.io
  2. CrÃ©er le premier compte (sera admin)
  3. Configurer l'entreprise

Logs utiles :
  kubectl logs -n chatwoot -l component=web --tail=50
  kubectl logs -n chatwoot -l component=worker --tail=50
  kubectl logs -n chatwoot job/chatwoot-db-migrate

Architecture :
  âœ“ PostgreSQL : 10.0.0.10:5432 (LB Hetzner â†’ HAProxy â†’ Patroni)
  âœ“ Redis      : 10.0.0.10:6379 (LB Hetzner â†’ HAProxy â†’ Sentinel)
  âœ“ RabbitMQ   : 10.0.0.10:5672 (LB Hetzner â†’ HAProxy â†’ Cluster)

Prochaine Ã©tape :
  ./13_deploy_superset_FIXED.sh

